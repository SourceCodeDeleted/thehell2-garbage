cmake_minimum_required(VERSION 3.0)

include(bitness REQUIRED)

set(StormLib_DIR "" CACHE PATH "StormLib sources directory")
if (NOT StormLib_DIR)
	message(FATAL_ERROR "You should specify StormLib_DIR variable")
endif (NOT StormLib_DIR)

function(_FindStormLib)
	find_path(STORMLIB_INCLUDE_DIR StormLib.h HINTS ${StormLib_DIR} ${StormLib_DIR}/src)

	set(STORMLIB_LIB_HINT ${StormLib_DIR}/lib/${PLATFORM_SUFFIX})

	find_library(STORMLIB_LIBRARY_DAD StormLibDAD HINTS ${STORMLIB_LIB_HINT})
	find_library(STORMLIB_LIBRARY_DAS StormLibDAS HINTS ${STORMLIB_LIB_HINT})
	find_library(STORMLIB_LIBRARY_DUD StormLibDUD HINTS ${STORMLIB_LIB_HINT})
	find_library(STORMLIB_LIBRARY_DUS StormLibDUS HINTS ${STORMLIB_LIB_HINT})
	find_library(STORMLIB_LIBRARY_RAD StormLibRAD HINTS ${STORMLIB_LIB_HINT})
	find_library(STORMLIB_LIBRARY_RAS StormLibRAS HINTS ${STORMLIB_LIB_HINT})
	find_library(STORMLIB_LIBRARY_RUD StormLibRUD HINTS ${STORMLIB_LIB_HINT})
	find_library(STORMLIB_LIBRARY_RUS StormLibRUS HINTS ${STORMLIB_LIB_HINT})

	if (CMAKE_BUILD_TYPE STREQUAL "Debug")
		if (BUILD_SHARED_LIBS)
			if (UNICODE)
				set(STORMLIB_LIBRARIES ${STORMLIB_LIBRARY_DUD} PARENT_SCOPE)
			else (UNICODE)
				set(STORMLIB_LIBRARIES ${STORMLIB_LIBRARY_DAD} PARENT_SCOPE)
			endif (UNICODE)
		else (BUILD_SHARED_LIBS)
			if (UNICODE)
				set(STORMLIB_LIBRARIES ${STORMLIB_LIBRARY_DUS} PARENT_SCOPE)
			else (UNICODE)
				set(STORMLIB_LIBRARIES ${STORMLIB_LIBRARY_DAS} PARENT_SCOPE)
			endif (UNICODE)
		endif (BUILD_SHARED_LIBS)
	else (CMAKE_BUILD_TYPE STREQUAL "Debug")
		if (BUILD_SHARED_LIBS)
			if (UNICODE)
				set(STORMLIB_LIBRARIES ${STORMLIB_LIBRARY_RUD} PARENT_SCOPE)
			else (UNICODE)
				set(STORMLIB_LIBRARIES ${STORMLIB_LIBRARY_RAD} PARENT_SCOPE)
			endif (UNICODE)
		else (BUILD_SHARED_LIBS)
			if (UNICODE)
				set(STORMLIB_LIBRARIES ${STORMLIB_LIBRARY_RUS} PARENT_SCOPE)
			else (UNICODE)
				set(STORMLIB_LIBRARIES ${STORMLIB_LIBRARY_RAS} PARENT_SCOPE)
			endif (UNICODE)
		endif (BUILD_SHARED_LIBS)
	endif (CMAKE_BUILD_TYPE STREQUAL "Debug")

	set(STORMLIB_INCLUDE_DIRS ${STORMLIB_INCLUDE_DIR} PARENT_SCOPE)
	
	unset(STORMLIB_LIBRARY_DAD CACHE)
	unset(STORMLIB_LIBRARY_DAS CACHE)
	unset(STORMLIB_LIBRARY_DUD CACHE)	
	unset(STORMLIB_LIBRARY_DUS CACHE)
	unset(STORMLIB_LIBRARY_RAD CACHE)
	unset(STORMLIB_LIBRARY_RAS CACHE)
	unset(STORMLIB_LIBRARY_RUD CACHE)
	unset(STORMLIB_LIBRARY_RUS CACHE)
	
	
endfunction(_FindStormLib)

_FindStormLib()

include(FindPackageHandleStandardArgs)
find_package_handle_standard_args(StormLib DEFAULT_MSG STORMLIB_INCLUDE_DIRS STORMLIB_LIBRARIES)
message(STATUS "Using ${STORMLIB_LIBRARIES}")